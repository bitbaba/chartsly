Ext.define("Chartsly.series.indicator.AccumulationDistributionLine",{extend:"Ext.chart.series.Cartesian",alias:"series.adl",seriesType:"lineSeries",config:{highField:"high",lowField:"low",closeField:"close",volumeField:"volume"},constructor:function(b){var e=this;var i=Ext.data.StoreManager.lookup(b.store);var g=i.getRange();var c=0;var a=0;var d=0,f=0,h=0;i.each(function(m,k,l){d=m.get(b.highField);f=m.get(b.lowField);h=m.get(b.closeField);var n=((h-f)-(d-h))/(d-f);var j=n*m.get(b.volumeField);a=c+j;m.data.adl=a;c=a});this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.AccumulationDistributionLine",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.AccumulationDistributionLine"],alternateClassName:["Chartsly.chart.indicator.ADL","Chartsly.chart.ADL"],xtype:"adlchart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["adl"],/*renderer:function(g,e,f){return g}*/})}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.AverageDirectionalIndex",{extend:"Ext.chart.series.Cartesian",alias:"series.adx",seriesType:"lineSeries",config:{highField:"high",lowField:"low",closeField:"close",lookBackPeriod:14},constructor:function(c){var j=this;var p=Ext.data.StoreManager.lookup(c.store);var l=p.getRange();var m=Ext.Array.pluck(Ext.Array.pluck(l,"data"),c.highField);var h=Ext.Array.pluck(Ext.Array.pluck(l,"data"),c.lowField);var o=Ext.Array.pluck(Ext.Array.pluck(l,"data"),c.closeField);var f=[];tmp_Pdm=[];tmp_Ndm=[];tmp_Dx=[];tmp_Adx=[];var g=c.lookBackPeriod;var e=c.lookBackPeriod-1;var k=[];var d=[];var q=[];var i=[];var b=[];var a=[];var n=[];p.each(function(E,y,s){if(c.yField!="adx"){return false}if(y==0){f.push(null);tmp_Pdm.push(null);tmp_Ndm.push(null);tmp_Dx.push(null);tmp_Adx.push(null);k.push(null);d.push(null);q.push(null);b.push(null);a.push(null);i.push(null);n.push(null)}if(y!=0){var A=Ext.Array.max([m[y]-h[y],Math.abs(m[y]-o[y-1]),Math.abs(h[y]-o[y-1])]);E.data.tr=A;f.push(A);var C=((m[y]-m[y-1]>h[y-1]-h[y])?Ext.Array.max([m[y]-m[y-1],0]):0);E.data.pdm=C;tmp_Pdm.push(C);var v=((h[y-1]-h[y]>m[y]-m[y-1])?Ext.Array.max([h[y-1]-h[y],0]):0);E.data.ndm=v;tmp_Ndm.push(v)}if(y<=g){if(y!=0){tmp_Dx.push(null);tmp_Adx.push(null);k.push(null);d.push(null);q.push(null);b.push(null);a.push(null);i.push(null);n.push(null)}return}if(y==g+1){var D=Ext.Array.sum(f);E.data.trperiod=D;k.push(D);var z=Ext.Array.sum(tmp_Pdm);E.data.pdmperiod=z;d.push(z);var x=Ext.Array.sum(tmp_Ndm);E.data.ndmperiod=x;b.push(x)}else{var D=k[(y-1)]-(k[(y-1)]/(e+1))+f[y];E.data.trperiod=D;k.push(D);var z=(d[(y-1)]-(d[(y-1)]/g)+tmp_Pdm[y]);E.data.pdmperiod=z;d.push(z);var x=(b[(y-1)]-(b[(y-1)]/g)+tmp_Ndm[y]);E.data.ndmperiod=x;b.push(x)}var u=(100*d[y])/k[y];E.data.pdiperiod=u;q.push(u);var w=(100*b[y])/k[y];E.data.ndiperiod=w;a.push(w);var t=Math.abs(q[y]-a[y]);E.data.didiffperiod=t;i.push(t);var B=Math.abs(q[y]+a[y]);E.data.disumperiod=B;n.push(B);var F=100*(i[y]/n[y]);E.data.dx=F;tmp_Dx.push(F);if(y>2*e+1){if(y==2*e+2){var r=Ext.Array.sum(tmp_Dx)/g;E.data.adx=r;tmp_Adx.push(r)}else{var r=((tmp_Adx[y-1]*e)+tmp_Dx[y])/(e+1);E.data.adx=r;tmp_Adx.push(r)}}else{tmp_Adx.push(null)}});this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.AverageDirectionalIndex",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.AverageDirectionalIndex"],xtype:"adxchart",initConfig:function(a){var b=a.series[0];var c=b.lookBackPeriod;var c="";Ext.Array.each(a.axes,function(e,d,f){if(e.type==="numeric"){Ext.apply(e,{fields:["adx"]})}});a.series.push({store:a.series[0].store,type:"adx",xField:a.series[0].xField,yField:"pdiperiod",closeField:a.series[0].closeField,lookBackPeriod:14,style:{stroke:"green",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(j,e,h){var f=Util.formatNumber(e.get("open"),"0.0000");var k=Util.formatNumber(e.get("close"),"0.0000");var i=Util.formatNumber(e.get("high"),"0.0000");var d=Util.formatNumber(e.get("low"),"0.0000");var g=e.get("volume");j.setHtml("<table><tr><td>Open:</td><td>$"+f+"</td></tr><tr><td>Close:</td><td>$"+k+"</td></tr><tr><td>High:</td><td>$"+i+"</td></tr><tr><td>Low:</td><td>$"+d+"</td></tr><tr><td>Volume:</td><td>$"+g+"</td></tr></table>")}}});a.series.push({store:a.series[0].store,type:"adx",xField:a.series[0].xField,yField:"ndiperiod",closeField:a.series[0].closeField,lookBackPeriod:14,style:{stroke:"red",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(j,e,h){var f=Util.formatNumber(e.get("open"),"0.0000");var k=Util.formatNumber(e.get("close"),"0.0000");var i=Util.formatNumber(e.get("high"),"0.0000");var d=Util.formatNumber(e.get("low"),"0.0000");var g=e.get("volume");j.setHtml("<table><tr><td>Open:</td><td>$"+f+"</td></tr><tr><td>Close:</td><td>$"+k+"</td></tr><tr><td>High:</td><td>$"+i+"</td></tr><tr><td>Low:</td><td>$"+d+"</td></tr><tr><td>Volume:</td><td>$"+g+"</td></tr></table>")}}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.AverageTrueRange",{extend:"Ext.chart.series.Cartesian",alias:"series.atr",seriesType:"lineSeries",config:{highField:"high",lowField:"low",closeField:"close",period:14},constructor:function(c){var i=this;var p=Ext.data.StoreManager.lookup(c.store);var l=p.getRange();var d=0,j=0,o=0,h=0,b,a,n,g,m,f=[],k,e=c.period;p.each(function(s,q,r){d=s.get(c.highField);j=s.get(c.lowField);o=s.get(c.closeField);b=d-j;a=Math.abs(d-h);n=Math.abs(j-h);if(q==0){g=b}else{g=Ext.Array.max([b,a,n])}if(q==(e-1)){k=Ext.Array.mean(f)}if(q<e){f.push(g)}else{k=(m*(e-1)+g)/e}s.data.atr=k;m=k});this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.AverageTrueRange",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.AverageTrueRange"],alternateClassName:["Chartsly.chart.indicator.ATR","Chartsly.chart.ATR"],xtype:"atrchart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["atr"]})}});this.callParent(arguments)}});Ext.define("Setu.Util",{singleton:true,alias:"util",alternateClassName:"Util",isFieldPresent:function(b,e){var a=false;if(!Ext.isEmpty(b)&&!Ext.isEmpty(e)){var d=b.getModel().getFields();var c=Ext.Array.pluck(d,"name");a=Ext.Array.contains(c,e)}return a},formatNumber:function(b,a){if(!Ext.isEmpty(b)&&!Ext.isEmpty(a)){return Ext.util.Format.number(b,a)}}});Ext.define("Chartsly.series.indicator.ChaikinMoneyFlow",{extend:"Ext.chart.series.Area",alias:"series.chaikinmoneyflow",seriesType:"areaSeries",requires:"Setu.Util",config:{highField:"high",lowField:"low",closeField:"close",volumeField:"volume",chaikinMoneyFlowPeriod:20},constructor:function(d){var e=this;var c=Ext.data.StoreManager.lookup(d.store);var b=Util.isFieldPresent(c,d.yField);if(!b){var f=c.getRange();var a=d.chaikinMoneyFlowPeriod-1;c.each(function(o,m,g){var l=(((o.data[d.closeField]-o.data[d.lowField])-(o.data[d.highField]-o.data[d.closeField]))/(o.data[d.highField]-o.data[d.lowField]));o.data.mfm=l;var h=(l*o.data[d.volumeField]);o.data.mfVolume=h;if(m<a){o.periodCMF="";return}else{var j=Ext.Array.slice(f,m-a,m+1);var i=Ext.Array.pluck(Ext.Array.pluck(j,"data"),"mfVolume");var n=Ext.Array.pluck(Ext.Array.pluck(j,"data"),"volume");var k=Ext.Array.sum(i)/Ext.Array.sum(n);o.data.cmf=k}})}this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.ChaikinMoneyFlow",{extend:"Ext.chart.CartesianChart",alternateClassName:"Chartsly.chart.CMF",requires:["Chartsly.series.indicator.ChaikinMoneyFlow"],xtype:"chaikinmoneyflow",initConfig:function(a){var b=a.series[0];Ext.Array.each(a.axes,function(d,c,e){if(d.type==="numeric"){Ext.apply(d,{fields:["cmf"],maximum:1,minimum:-1})}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.CommodityChannelIndex",{extend:"Ext.chart.series.Cartesian",alias:"series.cci",seriesType:"cci",config:{strongLevel:100,weakLevel:-100,highField:"high",lowField:"low",closeField:"close",period:14},constructor:function(b){var e=this;var a=Ext.data.StoreManager.lookup(b.store);var g=0,d=[],f=b.period,c;a.each(function(l,h,k){g=(l.get(b.highField)+l.get(b.lowField)+l.get(b.closeField))/3;d.push(g);if(h>=f){var j=Ext.Array.slice(d,h-f,h);var i=Ext.Array.mean(j);var m=e.meanDeviation(i,j,f);c=(g-i)/(0.15*m)}l.data.cci=c});d=null;this.callParent(arguments)},meanDeviation:function(d,b,c){var a=0;Ext.Array.each(b,function(f,e){a+=Math.abs(d-f)});return a/c},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{strongLevel:b.config.strongLevel,weakLevel:b.config.weakLevel,period:b.config.period})}});Ext.define("Chartsly.sprite.indicator.CommodityChannelIndex",{alias:"sprite.cci",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool",strongLevel:"number",weakLevel:"number",period:"number"}}},list:null,drawStrong:function(q,h,c){var j=this.attr,g,n,l,b,p,o=0,m=c,d=false,a=false;var k=j.period-1;b=h[0];p=h[1];var f=b,e=p;for(g=3*k;g<h.length;g+=3){n=h[g];l=h[g+1];if(e<=l&&e<=m&&l>=m){o=n-(((l-m)*(n-f))/(l-e));q.beginPath();q.moveTo(o,m);d=true;a=false}if(e>=l&&e>=m&&l<=m){o=f+(((n-f)*(e-m))/(e-l));q.lineTo(o,m);q.closePath();q.fill();d=false;a=true}if(l>=m){if(!d){q.beginPath();q.moveTo(b,m);q.lineTo(b,p);d=true}q.lineTo(n,l)}f=n,e=l}if(!a){q.lineTo(n,m);q.closePath();q.fill()}},drawWeak:function(q,g,c){var h=this.attr,f,m,l,a,n,p=0,e=false,k=false,o=c;var j=h.period-1;a=g[0];n=g[1];var d=a,b=n;for(f=3*j;f<g.length;f+=3){m=g[f];l=g[f+1];if(b>=l&&b>=o&&l<=o){p=d+(((m-d)*(b-o))/(b-l));q.beginPath();q.moveTo(p,o);e=true;k=false}if(b<=l&&b<=o&&l>=o){p=m-(((l-o)*(m-d))/(l-b));q.lineTo(p,o);q.closePath();q.fill();e=false;k=true}if(l<=o){if(!e){q.beginPath();q.moveTo(m,o);q.lineTo(m,l);e=true}q.lineTo(m,l)}d=m,b=l}if(!k){q.lineTo(m,o);q.closePath();q.fill()}},renderAggregates:function(w,v,l,K,p,G,C){var m=this,j=m.attr,t=j.dataX,s=j.dataY,f=j.labels,R=f&&m.getMarker("labels"),O=m.getMarker("markers"),D=j.matrix,a=K.matrix,u=K.devicePixelRatio,B=D.getXX(),e=D.getYY(),c=D.getDX(),b=D.getDY(),A={},r=this.list||(this.list=[]),I,H,P,F,E=w.minX,d=w.maxX,g=w.minY,N=w.maxY,Q=w.startIdx;r.length=0;for(P=v;P<l;P++){var M=E[P],q=d[P],J=g[P],o=N[P];if(M<q){r.push(M*B+c,J*e+b,Q[P]);r.push(q*B+c,o*e+b,Q[P])}else{if(M>q){r.push(q*B+c,o*e+b,Q[P]);r.push(M*B+c,J*e+b,Q[P])}else{r.push(q*B+c,o*e+b,Q[P])}}}if(r.length){for(P=0;P<r.length;P+=3){I=r[P];H=r[P+1];F=r[P+2];if(O){m.drawMarker(I,H,F)}if(R&&f[F]){m.drawLabel(f[F],I,H,F,C)}}}var n=j.lineWidth*K.devicePixelRatio/2;n-=Math.floor(n);var L=Math.round(j.strongLevel*e+b)-n;var z=Math.round(j.weakLevel*e+b)-n;var h=Math.round(0*e+b)-n;if(r.length){var k=C[2];m.drawYLine(p,k,L);m.drawYLine(p,k,z);m.drawYLine(p,k,h,true);m.drawWeak(p,r,z);m.drawStrong(p,r,L);m.drawStroke(K,p,v,l,r,C[1]-u);p.stroke()}},drawYLine:function(c,b,e,a){c.beginPath();c.moveTo(0,e);c.lineTo(b,e);c.closePath();var d;if(a){d=c.getLineDash();c.setLineDash([3])}c.stroke();if(a){c.setLineDash(d)}}});Ext.define("Chartsly.chart.indicator.CommodityChannelIndex",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.CommodityChannelIndex","Chartsly.sprite.indicator.CommodityChannelIndex"],xtype:"ccichart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["cci"]})}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.FastStochasticOscillator",{extend:"Ext.chart.series.Cartesian",alias:"series.faststochasticoscillator",seriesType:"faststochasticoscillatorSeries",config:{overboughtLevel:80,oversoldLevel:30,highField:"high",lowField:"low",closeField:"close",openField:"open",lookBackPeriod:14,smaDays:3},constructor:function(b){var f=this;var k=Ext.data.StoreManager.lookup(b.store);var g=k.getRange();var h=Ext.Array.pluck(Ext.Array.pluck(g,"data"),b.highField);var d=Ext.Array.pluck(Ext.Array.pluck(g,"data"),b.lowField);var j=Ext.Array.pluck(Ext.Array.pluck(g,"data"),b.closeField);var c=b.lookBackPeriod-1;var i=0;var a=b.smaDays;var e=[];k.each(function(q,n,p){if(n<c){q.pctd="";return}var m=Ext.Array.max(Ext.Array.slice(h,n-c,n+1));var l=Ext.Array.min(Ext.Array.slice(d,n-c,n+1));var r=((q.data[b.closeField]-l)/(m-l))*100;e.push(r);if(e.length>b.smaDays){var o=Ext.Array.mean(Ext.Array.slice(e,i,a));i++;a++}q.data.pctk=r;q.data.pctd=o});this.callParent(arguments)},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{overboughtLevel:b.config.overboughtLevel,oversoldLevel:b.config.oversoldLevel,lookBackPeriod:b.config.lookBackPeriod})}});Ext.define("Chartsly.sprite.indicator.FastStochasticOscillator",{alias:"sprite.faststochasticoscillatorSeries",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool",overboughtLevel:"number",oversoldLevel:"number",lookBackPeriod:"number"}}},list:null,drawOverBought:function(q,h,c){var j=this.attr,g,n,l,b,p,o=0,m=c,d=false,a=false;var k=j.lookBackPeriod-1;b=h[0];p=h[1];var f=b,e=p;for(g=3*k;g<h.length;g+=3){n=h[g];l=h[g+1];if(e<=l&&e<=m&&l>=m){o=n-(((l-m)*(n-f))/(l-e));q.beginPath();q.moveTo(o,m);d=true;a=false}if(e>=l&&e>=m&&l<=m){o=f+(((n-f)*(e-m))/(e-l));q.lineTo(o,m);q.closePath();d=false;a=true}if(l>=m){if(!d){q.beginPath();q.moveTo(b,m);q.lineTo(b,p);d=true}q.lineTo(n,l)}f=n,e=l}if(!a){q.lineTo(n,m);q.closePath()}},drawOverSold:function(q,g,c){var h=this.attr,f,m,l,a,n,p=0,e=false,k=false,o=c;var j=h.lookBackPeriod-1;a=g[0];n=g[1];var d=a,b=n;for(f=3*j;f<g.length;f+=3){m=g[f];l=g[f+1];if(b>=l&&b>=o&&l<=o){p=d+(((m-d)*(b-o))/(b-l));q.beginPath();q.moveTo(p,o);e=true;k=false}if(b<=l&&b<=o&&l>=o){p=m-(((l-o)*(m-d))/(l-b));q.lineTo(p,o);q.closePath();e=false;k=true}if(l<=o){if(!e){q.beginPath();q.moveTo(m,o);q.lineTo(m,l);e=true}q.lineTo(m,l)}d=m,b=l}if(!k){q.lineTo(m,o);q.closePath()}},renderAggregates:function(w,v,l,K,p,G,C){var m=this,j=m.attr,t=j.dataX,s=j.dataY,f=j.labels,R=f&&m.getMarker("labels"),O=m.getMarker("markers"),D=j.matrix,a=K.matrix,u=K.devicePixelRatio,B=D.getXX(),e=D.getYY(),c=D.getDX(),b=D.getDY(),A={},r=this.list||(this.list=[]),I,H,P,F,E=w.minX,d=w.maxX,g=w.minY,N=w.maxY,Q=w.startIdx;r.length=0;for(P=v;P<l;P++){var M=E[P],q=d[P],J=g[P],o=N[P];if(M<q){r.push(M*B+c,J*e+b,Q[P]);r.push(q*B+c,o*e+b,Q[P])}else{if(M>q){r.push(q*B+c,o*e+b,Q[P]);r.push(M*B+c,J*e+b,Q[P])}else{r.push(q*B+c,o*e+b,Q[P])}}}if(r.length){for(P=0;P<r.length;P+=3){I=r[P];H=r[P+1];F=r[P+2];if(O){m.drawMarker(I,H,F)}if(R&&f[F]){m.drawLabel(f[F],I,H,F,C)}}}var n=j.lineWidth*K.devicePixelRatio/2;n-=Math.floor(n);var L=Math.round(j.overboughtLevel*e+b)-n;var z=Math.round(j.oversoldLevel*e+b)-n;var h=Math.round(50*e+b)-n;if(r.length){var k=C[2];m.drawYLine(p,k,L);m.drawYLine(p,k,z);m.drawYLine(p,k,h,true);m.drawOverSold(p,r,z);m.drawOverBought(p,r,L);m.drawStroke(K,p,v,l,r,C[1]-u);p.stroke()}},drawYLine:function(c,b,e,a){c.beginPath();c.moveTo(0,e);c.lineTo(b,e);c.closePath();var d;if(a){d=c.getLineDash();c.setLineDash([3])}c.stroke();if(a){c.setLineDash(d)}}});Ext.define("Chartsly.chart.indicator.FastStochasticOscillator",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.FastStochasticOscillator","Chartsly.sprite.indicator.FastStochasticOscillator"],xtype:"faststochasticoscillator",initConfig:function(b){var c=b.series[0];var a=c.overboughtLevel;var d=c.oversoldLevel;Ext.Array.each(b.axes,function(f,e,g){if(f.type==="numeric"){Ext.apply(f,{fields:["pctd","pctk"],maximum:100,minimum:0,renderer:function(j,h,i){if(j==d||j==50||j==a){return j}else{return""}}})}});b.series.push({store:b.series[0].store,type:"faststochasticoscillator",xField:"date",yField:"pctd",highField:"high",lowField:"low",closeField:"close",volumeField:"volume",overboughtLevel:80,oversoldLevel:30,lookBackPeriod:14,smaDays:3,smooth:true,style:{stroke:"black",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(k,f,i){var g=Util.formatNumber(f.get("open"),"0.0000");var l=Util.formatNumber(f.get("close"),"0.0000");var j=Util.formatNumber(f.get("high"),"0.0000");var e=Util.formatNumber(f.get("low"),"0.0000");var h=f.get("volume");k.setHtml("<table><tr><td>Open:</td><td>$"+g+"</td></tr><tr><td>Close:</td><td>$"+l+"</td></tr><tr><td>High:</td><td>$"+j+"</td></tr><tr><td>Low:</td><td>$"+e+"</td></tr><tr><td>Volume:</td><td>$"+h+"</td></tr></table>")}}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.MoneyFlowIndex",{extend:"Ext.chart.series.Cartesian",alias:"series.moneyflowindex",seriesType:"moneyflowindex",config:{overboughtLevel:80,oversoldLevel:20,highField:"high",lowField:"low",closeField:"close",volumeField:"volume",lookBackPeriod:14},constructor:function(c){var d=this;var b=Ext.data.StoreManager.lookup(c.store);var f=c.lookBackPeriod-1;var e=[];var a=[];b.each(function(k,h,j){var g=(k.get(c.highField)+k.get(c.lowField)+k.get(c.closeField))/3;var i=(g*k.get(c.volumeField));if(h>0){items=k.store.data.items;var m=(items[h-1].get(c.highField)+items[h-1].get(c.lowField)+items[h-1].get(c.closeField))/3;if(g>m){e[h]=i;a[h]=0}else{a[h]=i;e[h]=0}}if(h>f){lookbackperiodPostiveMoneyFlow=Ext.Array.sum(Ext.Array.slice(e,h-f,h+1));lookbackperiodNegativeMoneyFlow=Ext.Array.sum(Ext.Array.slice(a,h-f,h+1));var n=lookbackperiodPostiveMoneyFlow/lookbackperiodNegativeMoneyFlow;var l=(100-100/(1+n));k.data.mfi=l}});this.callParent(arguments)},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{overboughtLevel:b.config.overboughtLevel,oversoldLevel:b.config.oversoldLevel,lookBackPeriod:b.config.lookBackPeriod})}});Ext.define("Chartsly.sprite.indicator.MoneyFlowIndex",{alias:"sprite.moneyflowindex",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool",overboughtLevel:"number",oversoldLevel:"number",lookBackPeriod:"number"}}},list:null,drawOverBought:function(q,h,c){var j=this.attr,g,n,l,b,p,o=0,m=c,d=false,a=false;var k=j.lookBackPeriod-1;b=h[0];p=h[1];var f=b,e=p;for(g=3*k;g<h.length;g+=3){n=h[g];l=h[g+1];if(e<=l&&e<=m&&l>=m){o=n-(((l-m)*(n-f))/(l-e));q.beginPath();q.moveTo(o,m);d=true;a=false}if(e>=l&&e>=m&&l<=m){o=f+(((n-f)*(e-m))/(e-l));q.lineTo(o,m);q.closePath();q.fill();d=false;a=true}if(l>=m){if(!d){q.beginPath();q.moveTo(b,m);q.lineTo(b,p);d=true}q.lineTo(n,l)}f=n,e=l}if(!a){q.lineTo(n,m);q.closePath();q.fill()}},drawOverSold:function(q,g,c){var h=this.attr,f,m,l,a,n,p=0,e=false,k=false,o=c;var j=h.lookBackPeriod-1;a=g[0];n=g[1];var d=a,b=n;for(f=3*j;f<g.length;f+=3){m=g[f];l=g[f+1];if(b>=l&&b>=o&&l<=o){p=d+(((m-d)*(b-o))/(b-l));q.beginPath();q.moveTo(p,o);e=true;k=false}if(b<=l&&b<=o&&l>=o){p=m-(((l-o)*(m-d))/(l-b));q.lineTo(p,o);q.closePath();q.fill();e=false;k=true}if(l<=o){if(!e){q.beginPath();q.moveTo(m,o);q.lineTo(m,l);e=true}q.lineTo(m,l)}d=m,b=l}if(!k){q.lineTo(m,o);q.closePath();q.fill()}},renderAggregates:function(w,v,l,K,p,G,C){var m=this,j=m.attr,t=j.dataX,s=j.dataY,f=j.labels,R=f&&m.getMarker("labels"),O=m.getMarker("markers"),D=j.matrix,a=K.matrix,u=K.devicePixelRatio,B=D.getXX(),e=D.getYY(),c=D.getDX(),b=D.getDY(),A={},r=this.list||(this.list=[]),I,H,P,F,E=w.minX,d=w.maxX,g=w.minY,N=w.maxY,Q=w.startIdx;r.length=0;for(P=v;P<l;P++){var M=E[P],q=d[P],J=g[P],o=N[P];if(M<q){r.push(M*B+c,J*e+b,Q[P]);r.push(q*B+c,o*e+b,Q[P])}else{if(M>q){r.push(q*B+c,o*e+b,Q[P]);r.push(M*B+c,J*e+b,Q[P])}else{r.push(q*B+c,o*e+b,Q[P])}}}if(r.length){for(P=0;P<r.length;P+=3){I=r[P];H=r[P+1];F=r[P+2];if(O){m.drawMarker(I,H,F)}if(R&&f[F]){m.drawLabel(f[F],I,H,F,C)}}}var n=j.lineWidth*K.devicePixelRatio/2;n-=Math.floor(n);var L=Math.round(j.overboughtLevel*e+b)-n;var z=Math.round(j.oversoldLevel*e+b)-n;var h=Math.round(50*e+b)-n;if(r.length){var k=C[2];m.drawYLine(p,k,L);m.drawYLine(p,k,z);m.drawYLine(p,k,h,true);m.drawOverSold(p,r,z);m.drawOverBought(p,r,L);m.drawStroke(K,p,v,l,r,C[1]-u);p.stroke()}},drawYLine:function(c,b,e,a){c.beginPath();c.moveTo(0,e);c.lineTo(b,e);c.closePath();var d;if(a){d=c.getLineDash();c.setLineDash([3])}c.stroke();if(a){c.setLineDash(d)}}});Ext.define("Chartsly.chart.indicator.MoneyFlowIndex",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.MoneyFlowIndex","Chartsly.sprite.indicator.MoneyFlowIndex"],xtype:"moneyflowindexchart",initConfig:function(b){var c=b.series[0];var a=c.overboughtLevel;var d=c.oversoldLevel;Ext.Array.each(b.axes,function(f,e,g){if(f.type==="numeric"){Ext.apply(f,{fields:["mfi"],maximum:100,minimum:0,majorTickSteps:20,renderer:function(j,h,i){if(j==d||j==50||j==a){return j}else{return""}}})}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.MovingAverageConvergenceDivergence",{extend:"Ext.chart.series.Cartesian",alias:"series.macd",seriesType:"macd",config:{closeField:"close",period1:12,period2:26,signalPeriod:9},constructor:function(u){var v=this;var o=Ext.data.StoreManager.lookup(u.store);var c=o.getRange();var q=Ext.Array.pluck(Ext.Array.pluck(c,"data"),u.closeField);var b=u.period1,i=[],j=0,g;var a=u.period2,l=[],h=0,e;var p=u.signalPeriod,f=0,d;var m,k,n=[];var t=2/(b+1);var s=2/(a+1);var r=2/(p+1);o.each(function(A,x,z){m=A.data[u.closeField];if(x>=b){if(x==b){j=Ext.Array.mean(Ext.Array.slice(q,0,x))}else{j=(m-g)*t+g}g=j}if(x>=a){if(x==a){h=Ext.Array.mean(Ext.Array.slice(q,0,x))}else{h=(m-e)*s+e}e=h}if(j&&h){k=j-h;A.data.macd=k;n.push(k)}var w=n.length;var y=Ext.Array.max([b,a]);var B=y+p;if(x>=B){if(x==B){f=Ext.Array.mean(Ext.Array.slice(n,0,p))}else{f=(k-d)*r+d}d=f;A.data.sigmacd=f;A.data.histmacd=k-f}});this.callParent(arguments)},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{})}});Ext.define("Chartsly.sprite.indicator.MovingAverageConvergenceDivergence",{alias:"sprite.macd",extend:"Ext.chart.series.sprite.Line",renderAggregates:function(g,a,f,b,n,d,k){this.callParent(arguments);var j=this,h=j.attr,l=h.matrix,i=l.getYY(),m=l.getDY();var c=h.lineWidth*b.devicePixelRatio/2;c-=Math.floor(c);var e=Math.round(0*i+m)-c;j.drawYLine(n,k[2],e,true)},drawYLine:function(c,b,e,a){c.beginPath();c.moveTo(0,e);c.lineTo(b,e);c.closePath();var d;if(a){d=c.getLineDash();c.setLineDash([3])}c.stroke();if(a){c.setLineDash(d)}}});Ext.define("Chartsly.chart.indicator.MovingAverageConvergenceDivergence",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.MovingAverageConvergenceDivergence","Chartsly.sprite.indicator.MovingAverageConvergenceDivergence"],alternateClassName:["Chartsly.chart.indicator.MACD","Chartsly.chart.MACD"],xtype:"macdchart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["macd","sigmacd","histmacd"]})}});a.series.push({store:a.series[0].store,type:"macd",xField:"date",yField:"sigmacd",closeField:"close",period:a.period,signalPeriod:a.signalPeriod,style:{stroke:"rgba(255,102,102,0.75)",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(h,c,f){var d=Util.formatNumber(c.get("open"),"0.0000");var i=Util.formatNumber(c.get("close"),"0.0000");var g=Util.formatNumber(c.get("high"),"0.0000");var b=Util.formatNumber(c.get("low"),"0.0000");var e=c.get("volume");h.setHtml("<table><tr><td>Open:</td><td>$"+d+"</td></tr><tr><td>Close:</td><td>$"+i+"</td></tr><tr><td>High:</td><td>$"+g+"</td></tr><tr><td>Low:</td><td>$"+b+"</td></tr><tr><td>Volume:</td><td>$"+e+"</td></tr></table>")}}},{store:a.series[0].store,type:"bar",xField:"date",yField:"histmacd",style:{stroke:"rgba(228,124,124,0.75)",fillStyle:"rgba(228,124,124,0.75)"},marker:{opacity:1,scaling:0.01,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(h,c,f){var d=Util.formatNumber(c.get("open"),"0.0000");var i=Util.formatNumber(c.get("close"),"0.0000");var g=Util.formatNumber(c.get("high"),"0.0000");var b=Util.formatNumber(c.get("low"),"0.0000");var e=c.get("volume");h.setHtml("<table><tr><td>Open:</td><td>$"+d+"</td></tr><tr><td>Close:</td><td>$"+i+"</td></tr><tr><td>High:</td><td>$"+g+"</td></tr><tr><td>Low:</td><td>$"+b+"</td></tr><tr><td>Volume:</td><td>$"+e+"</td></tr></table>")}}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.OnBalanceVolume",{extend:"Ext.chart.series.Cartesian",alias:"series.obv",seriesType:"lineSeries",config:{closeField:"close",volumeField:"volume"},constructor:function(b){var e=this;var a=Ext.data.StoreManager.lookup(b.store);var g=0,h=0,c,f=0,d;a.each(function(k,i,j){g=k.get(b.closeField);d=k.get(b.volumeField);if(i==0){c=NaN}else{if(!f){c=d}else{if(g==h){c=f}if(g>h){c=f+d}if(g<h){c=f-d}}}k.data.obv=c;f=c;h=g});this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.OnBalanceVolume",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.OnBalanceVolume"],alternateClassName:["Chartsly.chart.indicator.OBV","Chartsly.chart.OBV"],xtype:"obvchart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["obv"]})}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.PriceMomentumOscillator",{extend:"Ext.chart.series.Cartesian",alias:"series.pmo",seriesType:"lineSeries",config:{closeField:"close",period1:35,period2:20,signalPeriod:10},constructor:function(r){var t=this;var i=0,u=0,o=r.period,n,h=[],f=[],g,e=0,m,l=0;var k=Ext.data.StoreManager.lookup(r.store);var d=k.getRange(o);var c=r.period1;var a=r.period2;var j=r.signalPeriod;var s=2/c;var q=2/a;var b=2/(j+1);var p=[];Ext.Array.each(d,function(w,v){if(v==0){return}i=w.get(r.closeField);u=k.getAt(v-1).get(r.closeField);n=((i-u)/u)*100;h.push(n);if(v<c){return}if(v==c){emaROC=Ext.Array.mean(h)}else{emaROC=(n*s)+(h[v-1]*(1-s))}f.push(emaROC);if(v>=(c+a)){if(v==(c+a)){m=Ext.Array.mean(Ext.Array.slice(f,1))}else{m=((emaROC*10-l)*q)+l}l=m;w.data.pmo=m;p.push(m)}if(v>=(c+a+j)){if(v==(c+a+j)){g=Ext.Array.mean(Ext.Array.slice(p,1,v))}else{g=(m-e)*b+e}e=g;w.data.sigpmo=g}});this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.PriceMomentumOscillator",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.PriceMomentumOscillator"],alternateClassName:["Chartsly.chart.indicator.PMO","Chartsly.chart.PMO"],xtype:"pmochart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["pmo","sigpmo"]})}});a.series.push({store:a.series[0].store,type:"pmo",xField:"date",yField:"sigpmo",closeField:"close",period1:a.period1,period2:a.period2,signalPeriod:a.signalPeriod,style:{stroke:"rgba(255,102,102,0.75)",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(h,c,f){var d=Util.formatNumber(c.get("open"),"0.0000");var i=Util.formatNumber(c.get("close"),"0.0000");var g=Util.formatNumber(c.get("high"),"0.0000");var b=Util.formatNumber(c.get("low"),"0.0000");var e=c.get("volume");h.setHtml("<table><tr><td>Open:</td><td>$"+d+"</td></tr><tr><td>Close:</td><td>$"+i+"</td></tr><tr><td>High:</td><td>$"+g+"</td></tr><tr><td>Low:</td><td>$"+b+"</td></tr><tr><td>Volume:</td><td>$"+e+"</td></tr></table>")}}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.RateOfChange",{extend:"Ext.chart.series.Cartesian",alias:"series.roc",seriesType:"lineSeries",config:{closeField:"close",period:14},constructor:function(b){var c=this;var a=Ext.data.StoreManager.lookup(b.store);var h=0,f=0,g=b.period,e;var d=a.getRange(g);Ext.Array.each(d,function(j,i){if(i<g){return}h=j.get(b.closeField);f=a.getAt(i-g).get(b.closeField);e=((h-f)/f)*100;j.data.roc=e});this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.RateOfChange",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.RateOfChange"],alternateClassName:["Chartsly.chart.indicator.ROC","Chartsly.chart.ROC"],xtype:"rocchart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["roc"]})}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.RelativeStrengthIndex",{extend:"Ext.chart.series.Cartesian",alias:"series.relativestrengthindex",seriesType:"relativestrengthindexSeries",config:{overboughtLevel:80,oversoldLevel:30,closeField:"close",lookBackPeriod:14},constructor:function(c){var d=this;var b=Ext.data.StoreManager.lookup(c.store);var e=b.getRange();var h=Ext.Array.pluck(Ext.Array.pluck(e,"data"),c.closeField);var g=c.lookBackPeriod-1;var f=[];var a=[];b.each(function(r,p,i){if(p<g){r.rsi="";return}var q=Ext.Array.slice(h,(p-g)+1,(p-g)+2)-Ext.Array.slice(h,(p-g)+0,(p-g)+1);if(q>0){f.push(q)}else{a.push(q*(-1))}var l=Ext.Array.sum(f);var o=Ext.Array.sum(a);var k=l/c.lookBackPeriod;var n=o/c.lookBackPeriod;var m=k/n;var j=100-(100/(1+m));j=Ext.util.Format.number(j,"0.00");r.data.rsi=j});this.callParent(arguments)},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{overboughtLevel:b.config.overboughtLevel,oversoldLevel:b.config.oversoldLevel,lookBackPeriod:b.config.lookBackPeriod})}});Ext.define("Chartsly.sprite.indicator.RelativeStrengthIndex",{alias:"sprite.relativestrengthindexSeries",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool",overboughtLevel:"number",oversoldLevel:"number",lookBackPeriod:"number"}}},list:null,drawOverBought:function(q,h,c){var j=this.attr,g,n,l,b,p,o=0,m=c,d=false,a=false;var k=j.lookBackPeriod-1;b=h[0];p=h[1];var f=b,e=p;for(g=3*k;g<h.length;g+=3){n=h[g];l=h[g+1];if(e<=l&&e<=m&&l>=m){o=n-(((l-m)*(n-f))/(l-e));q.beginPath();q.moveTo(o,m);d=true;a=false}if(e>=l&&e>=m&&l<=m){o=f+(((n-f)*(e-m))/(e-l));q.lineTo(o,m);q.closePath();q.fill();d=false;a=true}if(l>=m){if(!d){q.beginPath();q.moveTo(b,m);q.lineTo(b,p);d=true}q.lineTo(n,l)}f=n,e=l}if(!a){q.lineTo(n,m);q.closePath();q.fill()}},drawOverSold:function(q,g,c){var h=this.attr,f,m,l,a,n,p=0,e=false,k=false,o=c;var j=h.lookBackPeriod-1;a=g[0];n=g[1];var d=a,b=n;for(f=3*j;f<g.length;f+=3){m=g[f];l=g[f+1];if(b>=l&&b>=o&&l<=o){p=d+(((m-d)*(b-o))/(b-l));q.beginPath();q.moveTo(p,o);e=true;k=false}if(b<=l&&b<=o&&l>=o){p=m-(((l-o)*(m-d))/(l-b));q.lineTo(p,o);q.closePath();q.fill();e=false;k=true}if(l<=o){if(!e){q.beginPath();q.moveTo(m,o);q.lineTo(m,l);e=true}q.lineTo(m,l)}d=m,b=l}if(!k){q.lineTo(m,o);q.closePath();q.fill()}},renderAggregates:function(w,v,l,K,p,G,C){var m=this,j=m.attr,t=j.dataX,s=j.dataY,f=j.labels,R=f&&m.getMarker("labels"),O=m.getMarker("markers"),D=j.matrix,a=K.matrix,u=K.devicePixelRatio,B=D.getXX(),e=D.getYY(),c=D.getDX(),b=D.getDY(),A={},r=this.list||(this.list=[]),I,H,P,F,E=w.minX,d=w.maxX,g=w.minY,N=w.maxY,Q=w.startIdx;r.length=0;for(P=v;P<l;P++){var M=E[P],q=d[P],J=g[P],o=N[P];if(M<q){r.push(M*B+c,J*e+b,Q[P]);r.push(q*B+c,o*e+b,Q[P])}else{if(M>q){r.push(q*B+c,o*e+b,Q[P]);r.push(M*B+c,J*e+b,Q[P])}else{r.push(q*B+c,o*e+b,Q[P])}}}if(r.length){for(P=0;P<r.length;P+=3){I=r[P];H=r[P+1];F=r[P+2];if(O){m.drawMarker(I,H,F)}if(R&&f[F]){m.drawLabel(f[F],I,H,F,C)}}}var n=j.lineWidth*K.devicePixelRatio/2;n-=Math.floor(n);var L=Math.round(j.overboughtLevel*e+b)-n;var z=Math.round(j.oversoldLevel*e+b)-n;var h=Math.round(50*e+b)-n;if(r.length){var k=C[2];m.drawYLine(p,k,L);m.drawYLine(p,k,z);m.drawYLine(p,k,h,true);m.drawOverSold(p,r,z);m.drawOverBought(p,r,L);m.drawStroke(K,p,v,l,r,C[1]-u);p.stroke()}},drawYLine:function(c,b,e,a){c.beginPath();c.moveTo(0,e);c.lineTo(b,e);c.closePath();var d;if(a){d=c.getLineDash();c.setLineDash([3])}c.stroke();if(a){c.setLineDash(d)}}});Ext.define("Chartsly.chart.indicator.RelativeStrengthIndex",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.RelativeStrengthIndex","Chartsly.sprite.indicator.RelativeStrengthIndex"],xtype:"rsichart",initConfig:function(b){var c=b.series[0];var a=c.overboughtLevel;var d=c.oversoldLevel;Ext.Array.each(b.axes,function(f,e,g){if(f.type==="numeric"){Ext.apply(f,{fields:["rsi"],maximum:100,minimum:0,renderer:function(j,h,i){if(j==d||j==50||j==a){return j}else{return""}}})}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.RelativeVigorIndex",{extend:"Ext.chart.series.Cartesian",alias:"series.rvi",seriesType:"lineSeries",config:{openField:"open",highField:"high",lowField:"low",closeField:"close",period:10,signalPeriod:4},constructor:function(e){var j=this;var p=Ext.data.StoreManager.lookup(e.store);var k=p.getRange();var o=0,i=e.period,f=e.signalPeriod,c,g=0,m=[],d,a=[],h,l=0;var n=2/(i+1);var b=2/(f+1);Ext.Array.each(k,function(r,q){d=(r.data[e.closeField]-r.data[e.openField])/(r.data[e.highField]-r.data[e.lowField]);a.push(d);if(q>=i){if(q==i){c=Ext.Array.mean(Ext.Array.slice(a,0,i))}else{c=(d-g)*n+g}g=c;r.data.rvi=c;m.push(c)}if(q>=i+f){if(q==i+f){h=Ext.Array.mean(Ext.Array.slice(m,0,f))}else{h=(c-l)*b+l}l=h;r.data.sigrvi=h}});delete a;delete m;this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.RelativeVigorIndex",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.RelativeVigorIndex"],alternateClassName:["Chartsly.chart.indicator.RVI","Chartsly.chart.RVI"],xtype:"rvichart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["rvi","sigrvi"]})}});a.series.push({store:a.series[0].store,type:"rvi",xField:"date",yField:"sigrvi",closeField:"close",period:a.period,signalPeriod:a.signalPeriod,style:{stroke:"rgba(255,102,102,0.75)",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(h,c,f){var d=Util.formatNumber(c.get("open"),"0.0000");var i=Util.formatNumber(c.get("close"),"0.0000");var g=Util.formatNumber(c.get("high"),"0.0000");var b=Util.formatNumber(c.get("low"),"0.0000");var e=c.get("volume");h.setHtml("<table><tr><td>Open:</td><td>$"+d+"</td></tr><tr><td>Close:</td><td>$"+i+"</td></tr><tr><td>High:</td><td>$"+g+"</td></tr><tr><td>Low:</td><td>$"+b+"</td></tr><tr><td>Volume:</td><td>$"+e+"</td></tr></table>")}}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.SlowStochasticOscillator",{extend:"Ext.chart.series.Cartesian",alias:"series.slowstochasticoscillator",config:{overboughtLevel:80,oversoldLevel:20,highField:"high",lowField:"low",closeField:"close",lookBackPeriod:14,smaPctK:3,smaPctD:3},constructor:function(b){if(b.yField=="slowpctk"){this.seriesType="slowstochasticoscillator"}else{this.seriesType="lineSeries"}var h=this;var m=Ext.data.StoreManager.lookup(b.store);var c=b.lookBackPeriod-1;var j=m.getRange();var k=Ext.Array.pluck(Ext.Array.pluck(j,"data"),b.highField);var f=Ext.Array.pluck(Ext.Array.pluck(j,"data"),b.lowField);var l=[];var g=[];var a=0;var d=b.smaPctK;var e=0;var i=b.smaPctD;m.each(function(s,p,r){if(p>c){var o=Ext.Array.max(Ext.Array.slice(k,p-c,p+1));var n=Ext.Array.min(Ext.Array.slice(f,p-c,p+1));var t=((s.data[b.closeField]-n)/(o-n))*100;l.push(t);if(l.length>b.smaPctK){var q=Ext.Array.mean(Ext.Array.slice(l,a,d));a++;d++;g.push(q)}if(g.length>b.smaPctD){var u=Ext.Array.mean(Ext.Array.slice(g,e,i));e++;i++}s.data.slowpctk=q;s.data.slowptcd=u}});this.callParent(arguments)},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{overboughtLevel:b.config.overboughtLevel,oversoldLevel:b.config.oversoldLevel,lookBackPeriod:b.config.lookBackPeriod})}});Ext.define("Chartsly.sprite.indicator.SlowStochasticOscillator",{alias:"sprite.slowstochasticoscillator",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool",overboughtLevel:"number",oversoldLevel:"number",lookBackPeriod:"number"}}},list:null,renderAggregates:function(w,v,l,K,p,G,C){var m=this,j=m.attr,t=j.dataX,s=j.dataY,f=j.labels,R=f&&m.getMarker("labels"),O=m.getMarker("markers"),D=j.matrix,a=K.matrix,u=K.devicePixelRatio,B=D.getXX(),e=D.getYY(),c=D.getDX(),b=D.getDY(),A={},r=this.list||(this.list=[]),I,H,P,F,E=w.minX,d=w.maxX,g=w.minY,N=w.maxY,Q=w.startIdx;r.length=0;for(P=v;P<l;P++){var M=E[P],q=d[P],J=g[P],o=N[P];if(M<q){r.push(M*B+c,J*e+b,Q[P]);r.push(q*B+c,o*e+b,Q[P])}else{if(M>q){r.push(q*B+c,o*e+b,Q[P]);r.push(M*B+c,J*e+b,Q[P])}else{r.push(q*B+c,o*e+b,Q[P])}}}if(r.length){for(P=0;P<r.length;P+=3){I=r[P];H=r[P+1];F=r[P+2];if(O){m.drawMarker(I,H,F)}if(R&&f[F]){m.drawLabel(f[F],I,H,F,C)}}}var n=j.lineWidth*K.devicePixelRatio/2;n-=Math.floor(n);var L=Math.round(j.overboughtLevel*e+b)-n;var z=Math.round(j.oversoldLevel*e+b)-n;var h=Math.round(50*e+b)-n;if(r.length){var k=C[2];m.drawYLine(p,k,L);m.drawYLine(p,k,z);m.drawYLine(p,k,h,true);m.drawStroke(K,p,v,l,r,C[1]-u);p.stroke()}},drawYLine:function(c,b,e,a){c.beginPath();c.moveTo(0,e);c.lineTo(b,e);c.closePath();var d;if(a){d=c.getLineDash();c.setLineDash([3])}c.stroke();if(a){c.setLineDash(d)}}});Ext.define("Chartsly.chart.indicator.SlowStochasticOscillator",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.SlowStochasticOscillator","Chartsly.sprite.indicator.SlowStochasticOscillator"],xtype:"slowstochasticoscillator",initConfig:function(b){var c=b.series[0];var a=c.overboughtLevel;var d=c.oversoldLevel;Ext.Array.each(b.axes,function(f,e,g){if(f.type==="numeric"){Ext.apply(f,{fields:["slowpctk","slowptcd"],maximum:100,minimum:0,majorTickSteps:20,renderer:function(j,h,i){if(j==d||j==50||j==a){return j}else{return""}}})}});b.series.push({store:b.series[0].store,type:"slowstochasticoscillator",xField:"date",yField:"slowptcd",style:{stroke:"rgba(255,0,0,0.75)",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(k,f,i){var g=Util.formatNumber(f.get("open"),"0.0000");var l=Util.formatNumber(f.get("close"),"0.0000");var j=Util.formatNumber(f.get("high"),"0.0000");var e=Util.formatNumber(f.get("low"),"0.0000");var h=f.get("volume");k.setHtml("<table><tr><td>Open:</td><td>$"+g+"</td></tr><tr><td>Close:</td><td>$"+l+"</td></tr><tr><td>High:</td><td>$"+j+"</td></tr><tr><td>Low:</td><td>$"+e+"</td></tr><tr><td>Volume:</td><td>$"+h+"</td></tr></table>")}}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.TRIX",{extend:"Ext.chart.series.Cartesian",alias:"series.trix",seriesType:"lineSeries",config:{closeField:"close",period:15,signalPeriod:9},constructor:function(t){var u=this;var r=t.period;var g=t.signalPeriod;var q=Ext.data.StoreManager.lookup(t.store);var a=q.getRange();var s=Ext.Array.pluck(Ext.Array.pluck(a,"data"),t.closeField);var p=Ext.Array.mean(Ext.Array.slice(s,0,r));var k=2/(r+1);var j,f,i=[],m=[],h,c,e,b,o,n=[],d,l;q.each(function(x,v,w){if(v>=r){if(v==r){j=p}else{j=(x.get(t.closeField)-f)*k+f}i.push(j);f=j}if(v>=2*r){if(v==2*r){h=Ext.Array.mean(Ext.Array.slice(i,0,v))}else{h=(j-c)*k+c}m.push(h);c=h}if(v>=3*r){if(v==3*r){e=Ext.Array.mean(Ext.Array.slice(m,0,v))}else{e=(h-b)*k+b}o=((b-e)*100)/b;x.data.trix=o;n.push(o);b=e;if(v>=(3*r+1+g)){if(v==(3*r+1+g)){d=Ext.Array.mean(Ext.Array.slice(n,1,g))}else{d=(o-l)*k+l}x.data.sigtrix=d;l=d}}});delete i;delete m;delete n;this.callParent(arguments)}});Ext.define("Chartsly.chart.indicator.TRIX",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.TRIX"],xtype:"trixchart",initConfig:function(a){Ext.Array.each(a.axes,function(c,b,d){if(c.type==="numeric"){Ext.apply(c,{fields:["trix","sigtrix"]})}});a.series.push({store:a.series[0].store,type:"trix",xField:"date",yField:"sigtrix",closeField:"close",period:a.period,signalPeriod:a.signalPeriod,style:{stroke:"rgba(255,102,102,0.75)",miterLimit:1},marker:{opacity:1,scaling:0.2,fillStyle:"#E3742D",fx:{duration:20,easing:"easeOut"}},highlightCfg:{opacity:1,scaling:1.5},tooltip:{trackMouse:true,style:{backgroundColor:"#fff",border:"2px solid #E3742D",fontFamily:"Helvetica"},renderer:function(h,c,f){var d=Util.formatNumber(c.get("open"),"0.0000");var i=Util.formatNumber(c.get("close"),"0.0000");var g=Util.formatNumber(c.get("high"),"0.0000");var b=Util.formatNumber(c.get("low"),"0.0000");var e=c.get("volume");h.setHtml("<table><tr><td>Open:</td><td>$"+d+"</td></tr><tr><td>Close:</td><td>$"+i+"</td></tr><tr><td>High:</td><td>$"+g+"</td></tr><tr><td>Low:</td><td>$"+b+"</td></tr><tr><td>Volume:</td><td>$"+e+"</td></tr></table>")}}});this.callParent(arguments)}});Ext.define("Chartsly.series.indicator.WilliamPctR",{extend:"Ext.chart.series.Cartesian",alias:"series.williampctr",seriesType:"williampctr",config:{overboughtLevel:-20,oversoldLevel:-80,highField:"high",lowField:"low",closeField:"close",lookBackPeriod:14},constructor:function(d){var e=this;var c=Ext.data.StoreManager.lookup(d.store);var f=c.getRange();var a=Ext.Array.pluck(Ext.Array.pluck(f,"data"),d.highField);var b=Ext.Array.pluck(Ext.Array.pluck(f,"data"),d.lowField);var g=d.lookBackPeriod-1;c.each(function(m,k,l){if(k<g){m.pctr="";return}var j=Ext.Array.max(Ext.Array.slice(a,k-g,k+1));var h=Ext.Array.min(Ext.Array.slice(b,k-g,k+1));var i=((j-m.data[d.closeField])/(j-h))*-100;m.data.pctr=i});this.callParent(arguments)},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{overboughtLevel:b.config.overboughtLevel,oversoldLevel:b.config.oversoldLevel,lookBackPeriod:b.config.lookBackPeriod})}});Ext.define("Chartsly.sprite.indicator.WilliamPctR",{alias:"sprite.williampctr",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool",overboughtLevel:"number",oversoldLevel:"number",lookBackPeriod:"number"}}},list:null,drawOverBought:function(q,h,c){var j=this.attr,g,n,l,b,p,o=0,m=c,d=false,a=false;var k=j.lookBackPeriod-1;b=h[0];p=h[1];var f=b,e=p;for(g=3*k;g<h.length;g+=3){n=h[g];l=h[g+1];if(e<=l&&e<=m&&l>=m){o=n-(((l-m)*(n-f))/(l-e));q.beginPath();q.moveTo(o,m);d=true;a=false}if(e>=l&&e>=m&&l<=m){o=f+(((n-f)*(e-m))/(e-l));q.lineTo(o,m);q.closePath();q.fill();d=false;a=true}if(l>=m){if(!d){q.beginPath();q.moveTo(b,m);q.lineTo(b,p);d=true}q.lineTo(n,l)}f=n,e=l}if(!a){q.lineTo(n,m);q.closePath();q.fill()}},drawOverSold:function(q,g,c){var h=this.attr,f,m,l,a,n,p=0,e=false,k=false,o=c;var j=h.lookBackPeriod-1;a=g[0];n=g[1];var d=a,b=n;for(f=3*j;f<g.length;f+=3){m=g[f];l=g[f+1];if(b>=l&&b>=o&&l<=o){p=d+(((m-d)*(b-o))/(b-l));q.beginPath();q.moveTo(p,o);e=true;k=false}if(b<=l&&b<=o&&l>=o){p=m-(((l-o)*(m-d))/(l-b));q.lineTo(p,o);q.closePath();q.fill();e=false;k=true}if(l<=o){if(!e){q.beginPath();q.moveTo(m,o);q.lineTo(m,l);e=true}q.lineTo(m,l)}d=m,b=l}if(!k){q.lineTo(m,o);q.closePath();q.fill()}},renderAggregates:function(w,v,l,K,p,G,C){var m=this,j=m.attr,t=j.dataX,s=j.dataY,f=j.labels,R=f&&m.getMarker("labels"),O=m.getMarker("markers"),D=j.matrix,a=K.matrix,u=K.devicePixelRatio,B=D.getXX(),e=D.getYY(),c=D.getDX(),b=D.getDY(),A={},r=this.list||(this.list=[]),I,H,P,F,E=w.minX,d=w.maxX,g=w.minY,N=w.maxY,Q=w.startIdx;r.length=0;for(P=v;P<l;P++){var M=E[P],q=d[P],J=g[P],o=N[P];if(M<q){r.push(M*B+c,J*e+b,Q[P]);r.push(q*B+c,o*e+b,Q[P])}else{if(M>q){r.push(q*B+c,o*e+b,Q[P]);r.push(M*B+c,J*e+b,Q[P])}else{r.push(q*B+c,o*e+b,Q[P])}}}if(r.length){for(P=0;P<r.length;P+=3){I=r[P];H=r[P+1];F=r[P+2];if(O){m.drawMarker(I,H,F)}if(R&&f[F]){m.drawLabel(f[F],I,H,F,C)}}}var n=j.lineWidth*K.devicePixelRatio/2;n-=Math.floor(n);var L=Math.round(j.overboughtLevel*e+b)-n;var z=Math.round(j.oversoldLevel*e+b)-n;var h=Math.round(-50*e+b)-n;if(r.length){var k=C[2];m.drawYLine(p,k,L);m.drawYLine(p,k,z);m.drawYLine(p,k,h,true);m.drawOverSold(p,r,z);m.drawOverBought(p,r,L);m.drawStroke(K,p,v,l,r,C[1]-u);p.stroke()}},drawYLine:function(c,b,e,a){c.beginPath();c.moveTo(0,e);c.lineTo(b,e);c.closePath();var d;if(a){d=c.getLineDash();c.setLineDash([3])}c.stroke();if(a){c.setLineDash(d)}}});Ext.define("Chartsly.chart.indicator.WilliamPctR",{extend:"Ext.chart.CartesianChart",requires:["Chartsly.series.indicator.WilliamPctR","Chartsly.sprite.indicator.WilliamPctR"],xtype:"williampctrchart",initConfig:function(b){var c=b.series[0];var a=c.overboughtLevel;var d=c.oversoldLevel;Ext.Array.each(b.axes,function(f,e,g){if(f.type==="numeric"){Ext.apply(f,{fields:["pctr"],maximum:0,minimum:-100,renderer:function(j,h,i){if(j==d||j==-50||j==a){return j}else{return""}}})}});this.callParent(arguments)}});Ext.define("Chartsly.interactions.Annotation",{extend:"Ext.chart.interactions.Abstract",requires:["Ext.chart.CartesianChart","Ext.chart.axis.layout.Discrete"],type:"annotation",alias:"interaction.annotation",config:{addGesture:"doubletap",moveGesture:"drag",editGesture:"tap",events:["annotationadded","annotationremoved","annotationupdated","beforeannotationmove","annotationmoved"]},annotations:[],itemOnMove:null,continueMove:false,updateChart:function(a){if(!(a instanceof Ext.chart.CartesianChart)){throw"Annotation interaction can only be used on cartesian charts."}this.callParent(arguments)},getGestures:function(){var a=this,b={};b[a.getAddGesture()]="onAddGesture";b[a.getMoveGesture()]="onGesture";b[a.getMoveGesture()+"start"]="onGestureStart";b[a.getMoveGesture()+"end"]="onGestureEnd";b[a.getEditGesture()]="onEditGestureEnd";return b},onAddGesture:function(h){var f=this,g=f.getChartPosition(h),c=f.getChart(),a=c.getSurface("overlay");var b={type:"image",x:g[0]-15,y:g[1]-30,draggable:true,src:"resources/images/Annotation.png"};var d=a.add(b);a.renderFrame();Ext.Msg.show({header:false,buttons:Ext.Msg.YESNOCANCEL,buttonText:{yes:"Save",no:"Remove"},multiline:true,closable:false,fn:function(i,j,e){if(i=="no"){a.remove(d);a.renderFrame();c.fireEvent("annotationremoved",c,h)}else{if(i=="yes"){f.annotations.push({text:j,sprite:d});c.fireEvent("annotationadded",c,j,d,h)}else{a.remove(d);a.renderFrame();c.fireEvent("annotationremoved",c,h)}}}})},onEditGestureEnd:function(f){var d=this,b=d.getChart(),a=b.getSurface("overlay"),c=d.getMatchingAnnotationSprite(f);if(c){Ext.Msg.show({header:false,buttons:Ext.Msg.YESNOCANCEL,buttonText:{yes:"Save",no:"Remove"},multiline:true,closable:false,value:c.text,fn:function(h,i,g){if(h=="cancel"){}else{if(h=="no"){a.remove(c.sprite);a.renderFrame();b.fireEvent("annotationremoved",b,f)}else{var e=c.text;c.text=i;b.fireEvent("annotationupdated",b,c.text,e,c.sprite,f)}}}})}},onGestureStart:function(d){var b=this,a=b.getChart();b.lockEvents(b.getMoveGesture());var c=b.getChartPosition(d);b.itemOnMove=b.getMatchingAnnotationSprite(d);if(b.itemOnMove){if(a.fireEvent("beforeannotationmove",a,b.itemOnMove.sprite,d)!=false){b.continueMove=true}}},onGesture:function(c){var a=this;if(!a.continueMove){return}if(a.getLocks()[a.getMoveGesture()]!==a){return}var b=a.getChartPosition(c);if(a.itemOnMove){a.itemOnMove.sprite.setAttributes({x:b[0]-15,y:b[1]-15});a.getChart().getSurface("overlay").renderFrame()}},onGestureEnd:function(d){var c=this,b=c.getChart(),a=b.getSurface("overlay");a.renderFrame();c.unlockEvents(c.getMoveGesture());if(Ext.isDefined(c.itemOnMove)){b.fireEvent("annotationmoved",b,c.itemOnMove.sprite,d)}},getChartPosition:function(d){var g=this;var f=g.getChart(),a=f.getSurface("overlay"),i=Ext.Array.slice(f.getInnerRect()),k=f.getInnerPadding(),m=k.left,l=k.top,c=i[2],b=i[3],n=f.getEventXY(d),j=n[0],h=n[1];if(j<0){j=0}else{if(j>c){j=c}}if(h<0){h=0}else{if(h>b){h=b}}j+=m;h+=l;return[j,h]},getMatchingAnnotationSprite:function(f){var h=this;var b=null,g=h.annotations,c,a=g.length,m=h.getChartPosition(f),k=m[0],j=m[1];for(c=0;c<a;c++){b=g[c];var d=b.sprite.attr;if((k>=d.x&&k<=(d.x+30))&&(j>=d.y&&j<=(d.y+30))){return b}}}});Ext.define("Chartsly.interactions.FibonacciRetracements",{extend:"Ext.chart.interactions.Abstract",requires:["Ext.chart.CartesianChart","Ext.chart.axis.layout.Discrete"],type:"fibonacci",alias:"interaction.fibonacci",config:{gesture:"drag"},applyLine:function(b,a){return Ext.merge(a||{},b)},updateChart:function(a){if(!(a instanceof Ext.chart.CartesianChart)){throw"Trendline interaction can only be used on cartesian charts."}this.callParent(arguments)},getGestures:function(){var a=this,b={};b[a.getGesture()]="onGesture";b[a.getGesture()+"start"]="onGestureStart";b[a.getGesture()+"end"]="onGestureEnd";return b},getNumericAxesValue:function(c){var q=this;var j=q.getChart();var h=j.getInnerPadding();var i=h.left;var g=h.top;var a=j.getAxes()[0];var b=a.getPosition();var e=a.getAlignment();var f=a.getSurface();var r=a.getSprites()[0];var l=r.attr.matrix;var m=r.attr.textPadding*2;var p=r.getLayoutContext();var o=a.getSegmenter();var k=l.getYY();var d=l.getDY();var n=(c-d-g)/k;if(a.getLayout() instanceof Ext.chart.axis.layout.Discrete){c=Math.round(n)*k+d+g;n=o.from(Math.round(n));n=r.attr.data[n]}else{n=o.from(n)}text=o.renderer(n,p);return text*1},drawRetracementRatio:function(d,a,e,b){if(a>750){if(e<50){var c={type:"text",text:d,fill:b,animate:true,font:"12px monospace",x:a-120,y:e+10};return c}else{var c={type:"text",text:d,fill:b,animate:true,font:"12px monospace",x:a-120,y:e};return c}}else{if(e<50){var c={type:"text",text:d,fill:b,animate:true,font:"12px monospace",x:a,y:e+10};return c}else{var c={type:"text",text:d,fill:b,animate:true,font:"12px monospace",x:a,y:e-10};return c}}},drawRetracementLine:function(e,c,a,d){var b=Ext.create("Ext.draw.Sprite",{type:"path",animate:true,path:"M "+c+" "+a,stroke:d,"stroke-width":1,opacity:0.5});return b},addStartingSprites:function(m,l){var k=this;chart=k.getChart(),surface=chart.getSurface("overlay");var q=m,o=l,i=k.startX,h=k.startY,g=[i,h],f=[i,(1-0.236)*1+h],e=[i,(1-0.382)*1+h],d=[i,(1-0.5)*1+h],c=[i,(1-0.618)*1+h],b=[i,(1-0.786)*1+h],a=[i,h];var p=k.startValueAtRatio;var j=k.getNumericAxesValue(l);var n=p-j;k.line1=k.drawRetracementLine(k,g[0],g[1],"#488CC9");surface.add(k.line1);k.line2=k.drawRetracementLine(k,f[0],f[1],"#498826");surface.add(k.line2);k.line3=k.drawRetracementLine(k,e[0],e[1],"#00BEFF");surface.add(k.line3);k.line4=k.drawRetracementLine(k,d[0],d[1],"#7642A7");surface.add(k.line4);k.line5=k.drawRetracementLine(k,c[0],c[1],"#2EA7B3");surface.add(k.line5);k.line6=k.drawRetracementLine(k,b[0],b[1],"#FF9900");surface.add(k.line6);k.line7=k.drawRetracementLine(k,a[0],a[1],"#488CC9");surface.add(k.line7)},drawRetracementsGrid:function(m,l){var D=this;chart=D.getChart(),surface=chart.getSurface("overlay");var d=m,b=l,w=D.startX,u=D.startY,A=[w,u],f=[d,u],z=[w,((1-0.236)*(b-u))+u],e=[d,((1-0.236)*(b-u))+u],v=[w,((1-0.382)*(b-u))+u],c=[d,((1-0.382)*(b-u))+u],t=[w,((1-0.5)*(b-u))+u],a=[d,((1-0.5)*(b-u))+u],s=[w,((1-0.618)*(b-u))+u],F=[d,((1-0.618)*(b-u))+u],r=[w,((1-0.786)*(b-u))+u],E=[d,((1-0.786)*(b-u))+u],q=[w,b],C=[d,b];var p=D.startValueAtRatio;var n=D.getNumericAxesValue(l);var o=p-n;D.line1.setAttributes({path:"M "+A[0]+" "+A[1]+" L "+f[0]+" "+f[1]});surface.remove(D.retracementRatio1);var i=D.drawRetracementRatio("100% ("+Ext.Number.toFixed(p,2)+")",A[0],A[1],"#488CC9");D.retracementRatio1=surface.add(i);var k=(o)*0.236+n;D.line2.setAttributes({path:"M "+z[0]+" "+z[1]+" L "+e[0]+" "+e[1]});surface.remove(D.retracementRatio2);i=D.drawRetracementRatio("38.2% ("+Ext.Number.toFixed(k,2)+")",z[0],z[1],"#498826");D.retracementRatio2=surface.add(i);var h=(o)*(0.382-0.236)+k;D.line3.setAttributes({path:"M "+v[0]+" "+v[1]+" L "+c[0]+" "+c[1]});surface.remove(D.retracementRatio3);i=D.drawRetracementRatio("38.2% ("+Ext.Number.toFixed(h,2)+")",v[0],v[1],"#00BEFF");D.retracementRatio3=surface.add(i);var B=(o)*(0.5-0.382)+h;D.line4.setAttributes({path:"M "+t[0]+" "+t[1]+" L "+a[0]+" "+a[1]});surface.remove(D.retracementRatio4);i=D.drawRetracementRatio("50% ("+Ext.Number.toFixed(B,2)+")",t[0],t[1],"#7642A7");D.retracementRatio4=surface.add(i);var j=(o)*(0.618-0.5)+B;D.line5.setAttributes({path:"M "+s[0]+" "+s[1]+" L "+F[0]+" "+F[1]});surface.remove(D.retracementRatio5);i=D.drawRetracementRatio("61.8% ("+Ext.Number.toFixed(j,2)+")",s[0],s[1],"#2EA7B3");D.retracementRatio5=surface.add(i);var g=(o)*(0.786-0.618)+j;D.line6.setAttributes({path:"M "+r[0]+" "+r[1]+" L "+E[0]+" "+E[1]});surface.remove(D.retracementRatio6);i=D.drawRetracementRatio("78.6% ("+Ext.Number.toFixed(g,2)+")",r[0],r[1],"#FF9900");D.retracementRatio6=surface.add(i);D.line7.setAttributes({path:"M "+q[0]+" "+q[1]+" L "+C[0]+" "+C[1]});surface.remove(D.retracementRatio7);i=D.drawRetracementRatio("0% ("+Ext.Number.toFixed(n,2)+")",q[0],q[1],"#488CC9");D.retracementRatio7=surface.add(i)},onGestureStart:function(d){var g=this;var f=g.getChart(),a=f.getSurface("overlay"),i=f.getInnerRect(),c=i[2],b=i[3],k=f.getEventXY(d),j=k[0],h=k[1];if(j>0&&j<c&&h>0&&h<b){g.lockEvents(g.getGesture());g.startX=j;g.startY=h;g.startValueAtRatio=g.getNumericAxesValue(h);a.removeAll();g.addStartingSprites(j,h,d);return false}},onGesture:function(d){var g=this;if(g.getLocks()[g.getGesture()]!==g){return}var f=g.getChart(),a=f.getSurface("overlay"),i=Ext.Array.slice(f.getInnerRect()),k=f.getInnerPadding(),m=k.left,l=k.top,c=i[2],b=i[3],n=f.getEventXY(d),j=n[0],h=n[1];if(j<0){j=0}else{if(j>c){j=c}}if(h<0){h=0}else{if(h>b){h=b}}j+=m;h+=l;g.drawRetracementsGrid(j,h);f.getSurface("overlay").renderFrame();return false},onGestureEnd:function(d){var c=this,b=c.getChart(),a=b.getSurface("overlay");a.renderFrame();c.unlockEvents(c.getGesture())}});Ext.define("Chartsly.interactions.Trendline",{extend:"Ext.chart.interactions.Abstract",requires:["Ext.chart.CartesianChart","Ext.chart.axis.layout.Discrete"],type:"trendline",alias:"interaction.trendline",config:{line:{strokeStyle:"red"},gesture:"drag"},applyLine:function(b,a){return Ext.merge(a||{},b)},updateChart:function(a){if(!(a instanceof Ext.chart.CartesianChart)){throw"Trendline interaction can only be used on cartesian charts."}this.callParent(arguments)},getGestures:function(){var a=this,b={};b[a.getGesture()]="onGesture";b[a.getGesture()+"end"]="onGestureEnd";b.mousedown="onGestureStart";return b},onGestureStart:function(f){var h=this;var g=h.getChart(),b=g.getSurface("overlay"),j=g.getInnerRect(),d=j[2],c=j[3],l=g.getEventXY(f),k=l[0],i=l[1],a=h.getLine();if(k>0&&k<d&&i>0&&i<c){h.lockEvents(h.getGesture());h.trendLine=b.add(Ext.apply({xclass:"Ext.draw.sprite.Line",fromX:k,fromY:i},a));return false}},onGesture:function(d){var g=this;if(g.getLocks()[g.getGesture()]!==g){return}var f=g.getChart(),a=f.getSurface("overlay"),i=Ext.Array.slice(f.getInnerRect()),k=f.getInnerPadding(),m=k.left,l=k.top,c=i[2],b=i[3],n=f.getEventXY(d),j=n[0],h=n[1];if(j<0){j=0}else{if(j>c){j=c}}if(h<0){h=0}else{if(h>b){h=b}}j+=m;h+=l;g.trendLine.setAttributes({toX:j,toY:h});a.renderFrame();return false},onGestureEnd:function(d){var c=this,b=c.getChart(),a=b.getSurface("overlay");a.renderFrame();c.unlockEvents(c.getGesture())}});Ext.define("Chartsly.sprite.Event",{alias:"sprite.event",extend:"Ext.chart.series.sprite.Aggregative",inheritableStatics:{def:{processors:{seq:"number"}}},list:null,renderAggregates:function(f,d,b,w,z,E,a){var K=this,v=K.attr,o=v.dataX,m=v.dataY,H=v.labels,A=v.matrix,g=w.matrix,c=w.devicePixelRatio,h=A.getXX(),u=A.getYY(),p=A.getDX(),n=A.getDY(),q={},D=K.list||(K.list=[]),l,k,B,j,e=f.minX,t=f.maxX,s=f.minY,J=f.maxY,r=f.startIdx;D.length=0;for(B=d;B<b;B++){var I=e[B],G=t[B],F=s[B],C=J[B];if(I<G){D.push(I*h+p,F*u+n,r[B]);D.push(G*h+p,C*u+n,r[B])}else{if(I>G){D.push(G*h+p,C*u+n,r[B]);D.push(I*h+p,F*u+n,r[B])}else{D.push(G*h+p,C*u+n,r[B])}}}if(D.length){for(B=0;B<D.length;B+=3){l=D[B];k=D[B+1];j=D[B+2];if(v.renderer){q={type:"marker",x:l,y:K.attr.seq*30};q=v.renderer.call(K,K,q,{store:K.getStore()},d+B/3)||{}}q.translationX=g.x(l,K.attr.seq*30);q.translationY=g.y(l,K.attr.seq*30);K.putMarker("markers",q,j,!v.renderer)}}},getIndexNearPoint:function(l,k){var m=this,g=m.attr,h=g.dataX,a=m.getSurface(),b=a.getRect()||[0,0,0,0],j=b[3],e,d,c,n,f=-1;if(g.flipXY){e=j-k;if(a.getInherited().rtl){d=b[2]-l}else{d=l}}else{e=l;d=j-k}var o=g.seq;for(c=0;c<h.length;c++){n=m.getMarkerBBox("markers",c);if(n&&e>=n.x&&e<=(n.x+n.width)&&d>=0&&d<=30){f=c}}return f}});Ext.define("Chartsly.series.Event",{extend:"Ext.chart.series.Cartesian",alias:"series.event",seriesType:"event",requires:["Chartsly.sprite.Event"],config:{eventType:"event",image:"resources/images/Event.png"},constructor:function(a){var e=this;var d=a.eventType;switch(d){case"dividend":e.setImage("resources/images/Dividend.png");break;case"bonus":e.setImage("resources/images/Bonus.png");break;case"split":e.setImage("resources/images/Split.png");break;case"rights":e.setImage("resources/images/Rights.png");break;default:e.setImage("resources/images/Event.png");break}Ext.apply(a,{marker:{type:"image",src:e.getImage(),width:30,height:30,x:-15,y:-30,fx:{duration:200}},tooltip:{trackMouse:true,style:"background: #fff",renderer:function(h,f,g){h.setHtml(Ext.String.capitalize(d)+" - "+f.get("type")+" : "+f.get(a.yField)+"%</br>"+f.get("remark"))}}});var c=a.chart.config.series;var b=0;e.eventSeriesSeq=0;for(b;b<c.length;b++){if(c[b].type=="event"){if(c[b].eventType==a.eventType){e.eventSeriesSeq=b}}}this.callParent(arguments)},getItemForPoint:function(a,g){if(this.getSprites()){var e=this,d=e.getChart(),f=d.getInnerPadding(),c=d.getInherited().rtl,b=e.sprites[0].config.seq;arguments[0]=a+(c?f.right:-f.left);arguments[1]=g+b*30+f.bottom;return e.callParent(arguments)}},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{seq:b.eventSeriesSeq})}});Ext.define("Chartsly.sprite.overlay.BollingerBands",{alias:"sprite.bbands",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool",period:"number",bandGap:"number"}}},list:null,drawUpperBand:function(b,g,e){var f=Ext.Array.clone(g);console.log(g.length+":"+e.length);var a=f.length;var d=e.length;var c=0;for(d;d>0;d--,c++){console.log((a-1-c*2)+":"+(d-1));f[a-1-c*2]=e[d-1]}},drawLowerBand:function(q,g,c){var h=this.attr,f,m,l,a,n,p=0,e=false,k=false,o=c;var j=h.lookBackPeriod-1;a=g[0];n=g[1];var d=a,b=n;for(f=3*j;f<g.length;f+=3){m=g[f];l=g[f+1];if(b>=l&&b>=o&&l<=o){p=d+(((m-d)*(b-o))/(b-l));q.beginPath();q.moveTo(p,o);e=true;k=false}if(b<=l&&b<=o&&l>=o){p=m-(((l-o)*(m-d))/(l-b));q.lineTo(p,o);q.closePath();q.fill();e=false;k=true}if(l<=o){if(!e){q.beginPath();q.moveTo(m,o);q.lineTo(m,l);e=true}q.lineTo(m,l)}d=m,b=l}if(!k){q.lineTo(m,o);q.closePath();q.fill()}},renderAggregates:function(E,D,n,S,u,O,H){var q=this,l=q.attr,A=l.dataX,z=l.dataY,j=l.labels,Y=j&&q.getBoundMarker("labels"),J=l.matrix,a=S.matrix,C=S.devicePixelRatio,G=J.getXX(),g=J.getYY(),d=J.getDX(),c=J.getDY(),F={},w=this.list||(this.list=[]),Q,P,W,M,K=E.minX,e=E.maxX,k=E.minY,V=E.maxY,X=E.startIdx;w.length=0;for(W=D;W<n;W++){var T=K[W],v=e[W],R=k[W],t=V[W];if(T<v){w.push(T*G+d,R*g+c,X[W]);w.push(v*G+d,t*g+c,X[W])}else{if(T>v){w.push(v*G+d,t*g+c,X[W]);w.push(T*G+d,R*g+c,X[W])}else{w.push(v*G+d,t*g+c,X[W])}}}var s=l.lineWidth*S.devicePixelRatio/2;s-=Math.floor(s);var h=q.getStore();var I=h.getRange();var L=Ext.Array.pluck(Ext.Array.pluck(I,"data"),"close");var o,N,B=[],r=[],b;var U=l.period;var f=l.bandGap;Ext.Array.each(I,function(p,i){if(i<U){return}b=Ext.Array.slice(L,i-U,i);N=Ext.Array.mean(b);o=q.standardDeviation(b,N);B.push(Math.round((N+o*f)*g+c)-s);r.push(Math.round((N-o*f)*g+c)-s)});if(w.length){var m=H[2];q.drawStroke(S,u,D,n,w,H[1]-C);u.stroke()}},standardDeviation:function(c,a){if(!a){a=Ext.Array.mean(Ext.Array.slice(c))}var d=0;Ext.Array.each(c,function(f,e){d+=Math.pow(f-a,2)});var b=Math.sqrt(d/c.length);return b}});Ext.define("Chartsly.series.overlay.BollingerBands",{extend:"Ext.chart.series.Cartesian",alias:"series.bbands",seriesType:"lineSeries",requires:["Chartsly.sprite.overlay.BollingerBands"],config:{closeField:"close",period:10,bandGap:2},constructor:function(b){var f=this;var i,a=b.period;var k=Ext.data.StoreManager.lookup(b.store);var g=k.getRange();var j=Ext.Array.pluck(Ext.Array.pluck(g,"data"),b.closeField);var c,l,h,e,d;Ext.Array.each(g,function(n,m){if(m<a){return}d=Ext.Array.slice(j,m-a,m);l=Ext.Array.mean(d);c=f.standardDeviation(d,l);n.data.bband=l;n.data.upperbband=l+c*b.bandGap;n.data.lowerbband=l-c*b.bandGap});this.callParent(arguments);this.on("chartattached",function(){alert("Chart Attached!!")})},standardDeviation:function(c,a){if(!a){a=Ext.Array.mean(Ext.Array.slice(c))}var d=0;Ext.Array.each(c,function(f,e){d+=Math.pow(f-a,2)});var b=Math.sqrt(d/c.length);return b},getDefaultSpriteConfig:function(){var b=this,a=b.callParent(arguments);return Ext.apply(a,{period:b.config.period,bandGap:b.config.bandGap})}});Ext.define("Chartsly.series.overlay.ExponentialMovingAverage",{extend:"Ext.chart.series.Cartesian",alias:"series.ema",seriesType:"lineSeries",config:{closeField:"close",period:10},constructor:function(b){var c=this;var e,a=b.period;var h=Ext.data.StoreManager.lookup(b.store);var d=h.getRange();var f=Ext.Array.pluck(Ext.Array.pluck(d,"data"),b.closeField);var i;var g=2/(a+1);Ext.Array.each(d,function(k,j){if(j<a){return}if(j==a){ema=Ext.Array.mean(Ext.Array.slice(f,j-a,j))}else{ema=(k.data[b.closeField]-i)*g+i}k.data.ema=ema;i=ema});this.callParent(arguments)}});Ext.define("Chartsly.series.overlay.MovingAverageEnvelops",{extend:"Ext.chart.series.Cartesian",alias:"series.maenv",seriesType:"lineSeries",config:{closeField:"close",period:20,percentage:2.5},constructor:function(c){var e=this;var g,b=c.period;var i=Ext.data.StoreManager.lookup(c.store);var f=i.getRange();var h=Ext.Array.pluck(Ext.Array.pluck(f,"data"),c.closeField);var g,a,d;Ext.Array.each(f,function(k,j){if(j<b){return}g=Ext.Array.mean(Ext.Array.slice(h,j-b,j));k.data.env=g;k.data.upperenv=g+(g*c.percentage/100);k.data.lowerenv=g-(g*c.percentage/100)});this.callParent(arguments)}});Ext.define("Chartsly.series.overlay.ParabolicSAR",{extend:"Ext.chart.series.Cartesian",alias:"series.parabolicsar",seriesType:"lineSeries",config:{highField:"high",lowField:"low"},constructor:function(o){var p=this;var e=0,c,d,g,n,r,h,u,l=0.02,f,t,i,q=false,b=false,m=true,s,k;var j=Ext.data.StoreManager.lookup(o.store);var a=j.getRange();Ext.Array.each(a,function(y,v){h=y.data[o.highField];u=y.data[o.lowField];if(v<=1){if(g&&h>g){console.log("UP");q=true;e=r;t=h;b=true}if(g&&h<g){console.log("DOWN");q=false;e=g;t=u;b=false}s=h;k=u}else{if(b==m){if(b){var x=c+(f*(i-c));var w=Ext.Array.min([r,n]);if(x<w){e=x}else{e=w}}else{var x=c+(f*(i-c));var w=Ext.Array.max([g,d]);if(x>w){e=x}else{e=w}}}else{e=i}y.data.sar=e;if(b){if(h>i){t=h}else{t=i}}else{if(u<i){t=u}else{t=i}}if(b){if(u>e){q=true}else{q=false}}else{if(h<e){q=false}else{q=true}}if(q==b){if(q){if(t>i){if(f==0.2){l=f}else{l=f+0.02}}else{l=f}}else{if(t<f){if(f=0.2){l=f}else{l=f+0.02}}else{l=f}}}else{l=0.02}}d=g;g=h;n=r;r=u;i=t;c=e;f=l;m=b;b=q});this.callParent(arguments)}});Ext.define("Chartsly.series.overlay.SimpleMovingAverage",{extend:"Ext.chart.series.Cartesian",alias:"series.sma",seriesType:"lineSeries",config:{closeField:"close",period:5},constructor:function(c){var d=this;var a,f=c.period;var b=Ext.data.StoreManager.lookup(c.store);var e=b.getRange();var g=Ext.Array.pluck(Ext.Array.pluck(e,"data"),c.closeField);Ext.Array.each(e,function(i,h){if(h<f){return}a=Ext.Array.mean(Ext.Array.slice(g,h-f,h));i.data.sma=a});this.callParent(arguments)}});Ext.define("Chartsly.sprite.indicator.PriceMomentumOscillator",{alias:"sprite.pmo",extend:"Ext.chart.series.sprite.Line",inheritableStatics:{def:{processors:{preciseStroke:"bool"}}},list:null});Ext.define("Chartsly.sprite.overlay.ParabolicSAR",{alias:"sprite.parabolicsar",extend:"Ext.chart.series.sprite.Line",list:null,drawSARUptrend:function(a,b){},drawSARDowntrend:function(a,b){},renderAggregates:function(u,t,j,H,n,D,z){var k=this,h=k.attr,r=h.dataX,q=h.dataY,f=h.labels,M=f&&k.getBoundMarker("labels"),A=h.matrix,a=H.matrix,s=H.devicePixelRatio,w=A.getXX(),e=A.getYY(),c=A.getDX(),b=A.getDY(),v={},p=this.list||(this.list=[]),F,E,K,C,B=u.minX,d=u.maxX,g=u.minY,J=u.maxY,L=u.startIdx;p.length=0;for(K=t;K<j;K++){var I=B[K],o=d[K],G=g[K],m=J[K];if(I<o){p.push(I*w+c,G*e+b,L[K]);p.push(o*w+c,m*e+b,L[K])}else{if(I>o){p.push(o*w+c,m*e+b,L[K]);p.push(I*w+c,G*e+b,L[K])}else{p.push(o*w+c,m*e+b,L[K])}}}var l=h.lineWidth*H.devicePixelRatio/2;l-=Math.floor(l);if(p.length){k.drawSARUptrend(n,p);k.drawSARDowntrend(n,p)}}});